<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Marker Crop</title>
  <link href="css/bootstrap.css" rel="stylesheet" type="text/css" media="all">
  <link href="css/cropper.css" rel="stylesheet" type="text/css" media="all">
  <link href="css/marker-crop.css" rel="stylesheet" type="text/css" media="all">
</head>
<body>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <ul class="nav navbar-nav">
	<li><span class="navbar-brand">Marker Crop</span></li>
	<li><a href="marker-crop.en.html">English</a></li>
	<li><a href="marker-crop.es.html">Espanol</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
	<li><button id="button-restart" class="btn btn-danger">Restart</button></li>
      </ul>
    </div>
  </nav>

  <div class="container-fluid">
    
    <div id="stage-loading" class="marker-stage">
      <div>
	<h1>Loading...</h1>
      </div>
      <div>
	<img src="spinner.gif">
      </div>
    </div>

    <div id="stage-fileselect" class="marker-stage" style="display: none">
      <p>Welcome to Marker Crop. This is a tool for automatically post-processing scanned book images. Marker Crop runs as an app entirely on your computer. No images are uploaded or processed anywhere else.</p>
      <div class="panel panel-success">
	<div class="panel-heading">
	  <h2 class="panel-title">Select Images (Stage 1/6)</h2>
	</div>
	<div class="panel-body">
	  <p>Once you have scanned using the physical markers, you can load them into the app for batch processing into a PDF. Make sure to select one complete book at a time.</p>
	  <form id="form-images">
	    <div class="form-group">
	      <label for="input-images">Select Images to Process</label>
	      <input type="file" id="input-images" name="file" multiple="multiple" webkitdirectory>
	      <p class="help-block">Choose a directory containing images you wish to collate into a PDF. All images inside that directory and in any subdirectories will be processed.</p>
	    </div>
	  </form>
	</div>
      </div>
    </div>

    <div id="stage-options" class="marker-stage" style="display: none">
      <div class="panel panel-success">
	<div class="panel-heading">
	  <h2 class="panel-title">Parameters(Stage 2/6)</h2>
	</div>
	<div class="panel-body">
	  <div class="row">
	    <div class="col-sm-6">
	      <form class="form-horizontal">

		<div id="odd-cropping-group" class="form-group">
		  <label class="col-sm-4 control-label">Odd Page Extra Cropping (pixels)</label>
		  <div class="col-sm-2">
		    <label for="input-border-top-odd" class="control-label">Top</label>
		    <input id="input-border-top-odd" type="number" class="form-control" value="50">
		  </div>
		  <div class="col-sm-2">
		    <label for="input-border-bottom-odd" class="control-label">Bottom</label>
		    <input id="input-border-bottom-odd" type="number" class="form-control" value="50">
		  </div>
		  <div class="col-sm-2">
		    <label for="input-border-gutter-odd" class="control-label">Gutter</label>
		    <input id="input-border-gutter-odd" type="number" class="form-control" value="-50">
		  </div>
		  <div class="col-sm-2">
		    <label for="input-border-edge-odd" class="control-label">Edge</label>
		    <input id="input-border-edge-odd" type="number" class="form-control" value="50">
		  </div>
		</div>
		<div id="even-cropping-group" class="form-group">
		  <label class="col-sm-4 control-label">Even Page Extra Cropping (pixels)</label>
		  <div class="col-sm-2">
		    <label for="input-border-top-even" class="control-label">Top</label>
		    <input id="input-border-top-even" type="number" class="form-control" value="50">
		  </div>
		  <div class="col-sm-2">
		    <label for="input-border-bottom-even" class="control-label">Bottom</label>
		    <input id="input-border-bottom-even" type="number" class="form-control" value="50">
		  </div>
		  <div class="col-sm-2">
		    <label for="input-border-gutter-even" class="control-label">Gutter</label>
		    <input id="input-border-gutter-even" type="number" class="form-control" value="-50">
		  </div>
		  <div class="col-sm-2">
		    <label for="input-border-edge-even" class="control-label">Edge</label>
		    <input id="input-border-edge-even" type="number" class="form-control" value="50">
		  </div>
		</div>
		
 		<div class="form-group">
		  <label for="select-margin" class="col-sm-4 control-label">Margin Padding Style</label>
		  <div class="col-sm-8">
		    <select id="select-margin" class="form-control">
		      <option value="blur">Blurred Edge Color</option>
		      <option value="mean" selected="selected">Image Mean Color</option>
		      <option value="white">White Bars</option>
		      <option value="black">Black Bars</option>
		    </select>
		  </div>
		</div>

		<div class="form-group">
		  <label for="select-quality" class="col-sm-4 control-label">JPEG Quality</label>
		  <div class="col-sm-8">
		    <select id="select-quality" class="form-control">
		      <option value="fair">Fair Quality (Low Size)</option>
		      <option value="good" selected="selected">Good Quality (Moderate Size)</option>
		      <option value="great">Great Quality (High Size)</option>
		    </select>
		  </div>
		</div>

		<div class="form-group">
		  <div class="col-sm-offset-4 col-sm-8">
		    <div class="checkbox">
		      <label>
			<input type="checkbox" id="checkbox-deskew">Deskew
		      </label>
		    </div>
		  </div>
		</div>
		
		<div class="form-group">
		  <div class="col-sm-offset-4 col-sm-8">
		    <div class="checkbox">
		      <label>
			<input type="checkbox" id="checkbox-sharpen">Sharpen
		      </label>
		    </div>
		  </div>
		</div>

		<div class="form-group">
		  <div class="col-sm-offset-4 col-sm-8">
		    <div class="checkbox">
		      <label>
			<input type="checkbox" id="checkbox-grayscale">Grayscale
		      </label>
		    </div>
		  </div>
		</div>

		<div class="form-group">
		  <div class="col-sm-offset-4 col-sm-8">
		    <button id="button-begin" class="btn btn-primary">Begin Processing</button>
		  </div>
		</div>
	      </form>
	    </div>

	    <div class="col-sm-6">
	      <div class="spinner"><h2>Sample Page <span id="sample-title-odd">(Even)</span><span id="sample-title-even">(Odd)</span></h2></div>
	      <div id="sample-loading" class="spinner sample-state" style="display: none">
		<img src="spinner.gif">
	      </div>
	      <div id="sample-buttons" class="sample-state" style="display: none">
		<div class="row">
		  <div class="col-sm-12">
		    <button id="update-sample" class="btn btn-default btn-block">Update View</button>
		  </div>
		</div>
		<div class="row">
		  <div class="col-sm-3">
		    <button id="sample-first" class="btn btn-default btn-block">First Page</button>
		  </div>
		  <div class="col-sm-2">
		    <button id="sample-previous" class="btn btn-default btn-block">Previous</button>
		  </div>
		  <div class="col-sm-2">
		    <button id="sample-random" class="btn btn-default btn-block">Random</button>
		  </div>
		  <div class="col-sm-2">
		    <button id="sample-next" class="btn btn-default btn-block">Next</button>
		  </div>
		  <div class="col-sm-3">
		    <button id="sample-last" class="btn btn-default btn-block">Last Page</button>
		  </div>
		</div>
	      </div>
	      <div id="sample-ready" class="spinner sample-state" style="display: none">
		<canvas id="canvas-sample-page" width="600" height="900"></canvas>
		<canvas id="canvas-sample-hidden" style="display: none"></canvas>
	      </div>
	      <div id="sample-failed" class="sample-state" style="display: none">
		<h2>Sample Failed to Process. Try another page.</h2>
		<p id="sample-failed-message"></p>
	      </div>
	    </div>
	  </div>
	</div>
      </div>
    </div>

    <div id="stage-processing" class="marker-stage" style="display: none">
      <div class="panel panel-success">
	<div class="panel-heading">
	  <h2 class="panel-title">Finding Markers (Stage 3/6)</h2>
	</div>
	<div class="panel-body">
	  <div class="spinner">
	    <h3 id="status">Searching Image <span id="current-process">0</span>/<span id="process-count">0</span></h3>
	  </div>
	  <div class="spinner">
	    <h4 id="failures" style="display: none">Images without markers <span id="failure-count">0</span></h4>
	  </div>
	  <div class="spinner">
	    <img src="spinner.gif">
	  </div>
	</div>
      </div>
    </div>

    <div id="stage-fixing" class="marker-stage" style="display: none">
      <div class="panel panel-success">
	<div class="panel-heading">
	  <h2>Manual Cropping (Stage 4/6)</h2>
	</div>
	<div class="panel-body">
	  <div>
	    <button id="button-fix-next" class="btn btn-primary pull-right">Next</button>
	    <h3>Fixing Image <span id="current-fix">0</span>/<span id="fix-count">0</span></h3>
	    <p>Fiducial markers were not found for this image. You must manually set the cropping region. Rotate to proper orientation, then drag the correct crop box for this page and then click next.</p>
	  </div>
	  <div>
	    <div id="fix-rotate-container">
	      <button id="button-fix-left" class="btn btn-default">Rotate Left</button>
	      <button id="button-fix-right" class="btn btn-default">Rotate Right</button>
	    </div>
	  </div>
	  <div>
	    <img id="image-fix">
	  </div>
	</div>
      </div>
    </div>

    <div id="stage-collating" class="marker-stage" style="display: none">
      <div class="panel panel-success">
	<div class="panel-heading">
	  <h2 class="panel-title">Collating Images (Stage 5/6)</h2>
	</div>
	<div class="panel-body">
	  <div class="spinner">
	    <h3 id="status">Collating Image into PDF <span id="current-collate">0</span>/<span id="collate-count">0</span></h3>
	  </div>
	  <div class="spinner">
	    <img src="spinner.gif">
	  </div>
	  <canvas id="canvas-collate" style="display: none"></canvas>
	</div>
      </div>
    </div>

    <div id="stage-save" class="marker-stage" style="display: none">
      <div class="panel panel-success">
	<div class="panel-heading">
	  <h2 class="panel-title">Save PDF to Disk (Stage 6/6)</h2>
	</div>
	<div class="panel-body">
	  <div class="spinner">
	    <button id="button-save" class="btn btn-primary">Save PDF</button>
	  </div>
	  <div id="embedded-pdf"></div>
	</div>
      </div>
    </div>
  </div>
  
  <script src="js/lib/jquery-3.3.1.js" type="text/javascript"></script>
  <script src="js/lib/cropper.js" type="text/javascript"></script>
  <script src="js/lib/jquery-cropper.js" type="text/javascript"></script>
  <script src="js/lib/bootstrap.js" type="text/javascript"></script>
  <script src="js/lib/underscore.js" type="text/javascript"></script>
  <script src="js/lib/jspdf.debug.js" type="text/javascript"></script>
  <script src="js/lib/dropzone.js" type="text/javascript"></script>
  <script src="js/lib/pdfobject.js" type="text/javascript"></script>
  <script src="js/lib/opencv.js" type="text/javascript"></script>

  <script src="js/ui.js" type="text/javascript"></script>
  <script src="js/process.js" type="text/javascript"></script>
  <script src="js/collate.js" type="text/javascript"></script>
</body>
</html>
